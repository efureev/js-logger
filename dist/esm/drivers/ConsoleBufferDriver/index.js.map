{"version":3,"file":"index.js","names":["ConsoleDriver","ConsoleBuffer","print","printFragmented","constructor","debugFn","output","dir","buffer","performLines","lines","type","perform","msg","buildStrings","formatMessage","warnFunc","warn","log","result","performFragmented","_returnResult","length","fragments","split","slice","styles","error","forEach","fragment","idx","clearBuffer"],"sources":["../../../../src/drivers/ConsoleBufferDriver/index.ts"],"sourcesContent":["import ConsoleDriver from '../ConsoleDriver'\nimport Message from '../../Message'\n\nexport interface ConsoleBufferConfig {\n  print?: boolean\n  printFragmented?: boolean\n  debugFn?: Function\n}\n\nexport default class ConsoleBuffer extends ConsoleDriver {\n  private readonly print: boolean = false\n  private readonly printFragmented: boolean = false\n  private readonly debugFn: Function\n\n  constructor({ print, printFragmented, debugFn }: ConsoleBufferConfig = {}) {\n    super()\n    this.print = print || false\n    this.printFragmented = printFragmented || false\n    this.debugFn = debugFn || this.output.dir\n  }\n\n  public buffer: string[] = []\n\n  public performLines(lines: string[], type: string): string[] | void {\n    this.buffer = [\n      ...this.buffer,\n      ...lines\n    ]\n  }\n\n  protected perform(msg: Message, type: string): string[] | void {\n    this.buffer = [\n      ...this.buffer,\n      ...ConsoleDriver.buildStrings(ConsoleDriver.formatMessage(msg))\n    ]\n\n    if (this.print) {\n      const warnFunc = this.output.warn ? this.output.warn : this.output.log\n\n      warnFunc('--[debug] start')\n\n      const result = super.perform(msg, type)\n\n      this.debugFn(this.buffer)\n      if (this.printFragmented) {\n        this.performFragmented()\n      }\n      warnFunc('--[debug] finish')\n      if (this._returnResult) {\n        return result\n      }\n    }\n  }\n\n  private performFragmented() {\n    if (!this.buffer.length) {\n      return\n    }\n\n    const fragments = this.buffer[0].split('%c').slice(1)\n    const styles = this.buffer.slice(1)\n\n    if (fragments.length != styles.length) {\n      this.output.error('data inconsistency error: fragments: %d, styles: %d', fragments.length, styles.length)\n      this.output.log('fragments', fragments)\n      this.output.log('styles', styles)\n    }\n\n    fragments.forEach((fragment, idx) => {\n      this.output.log(`${fragment}: ${styles[idx]}`)\n      this.output.log(`%c${fragment}`, styles[idx])\n    })\n  }\n\n  public clearBuffer() {\n    this.buffer = []\n  }\n}\n"],"mappings":"AAAA,OAAOA,aAAP,MAA0B,kBAA1B;AASA,eAAe,MAAMC,aAAN,SAA4BD,aAA5B,CAA0C;EACtCE,KAAK,GAAY,KAAZ;EACLC,eAAe,GAAY,KAAZ;;EAGhCC,WAAW,CAAC;IAAEF,KAAF;IAASC,eAAT;IAA0BE;EAA1B,IAA2D,EAA5D,EAAgE;IACzE;IACA,KAAKH,KAAL,GAAaA,KAAK,IAAI,KAAtB;IACA,KAAKC,eAAL,GAAuBA,eAAe,IAAI,KAA1C;IACA,KAAKE,OAAL,GAAeA,OAAO,IAAI,KAAKC,MAAL,CAAYC,GAAtC;EACD;;EAEMC,MAAM,GAAa,EAAb;;EAENC,YAAY,CAACC,KAAD,EAAkBC,IAAlB,EAAiD;IAClE,KAAKH,MAAL,GAAc,CACZ,GAAG,KAAKA,MADI,EAEZ,GAAGE,KAFS,CAAd;EAID;;EAESE,OAAO,CAACC,GAAD,EAAeF,IAAf,EAA8C;IAC7D,KAAKH,MAAL,GAAc,CACZ,GAAG,KAAKA,MADI,EAEZ,GAAGR,aAAa,CAACc,YAAd,CAA2Bd,aAAa,CAACe,aAAd,CAA4BF,GAA5B,CAA3B,CAFS,CAAd;;IAKA,IAAI,KAAKX,KAAT,EAAgB;MACd,MAAMc,QAAQ,GAAG,KAAKV,MAAL,CAAYW,IAAZ,GAAmB,KAAKX,MAAL,CAAYW,IAA/B,GAAsC,KAAKX,MAAL,CAAYY,GAAnE;MAEAF,QAAQ,CAAC,iBAAD,CAAR;MAEA,MAAMG,MAAM,GAAG,MAAMP,OAAN,CAAcC,GAAd,EAAmBF,IAAnB,CAAf;MAEA,KAAKN,OAAL,CAAa,KAAKG,MAAlB;;MACA,IAAI,KAAKL,eAAT,EAA0B;QACxB,KAAKiB,iBAAL;MACD;;MACDJ,QAAQ,CAAC,kBAAD,CAAR;;MACA,IAAI,KAAKK,aAAT,EAAwB;QACtB,OAAOF,MAAP;MACD;IACF;EACF;;EAEOC,iBAAiB,GAAG;IAC1B,IAAI,CAAC,KAAKZ,MAAL,CAAYc,MAAjB,EAAyB;MACvB;IACD;;IAED,MAAMC,SAAS,GAAG,KAAKf,MAAL,CAAY,CAAZ,EAAegB,KAAf,CAAqB,IAArB,EAA2BC,KAA3B,CAAiC,CAAjC,CAAlB;IACA,MAAMC,MAAM,GAAG,KAAKlB,MAAL,CAAYiB,KAAZ,CAAkB,CAAlB,CAAf;;IAEA,IAAIF,SAAS,CAACD,MAAV,IAAoBI,MAAM,CAACJ,MAA/B,EAAuC;MACrC,KAAKhB,MAAL,CAAYqB,KAAZ,CAAkB,qDAAlB,EAAyEJ,SAAS,CAACD,MAAnF,EAA2FI,MAAM,CAACJ,MAAlG;MACA,KAAKhB,MAAL,CAAYY,GAAZ,CAAgB,WAAhB,EAA6BK,SAA7B;MACA,KAAKjB,MAAL,CAAYY,GAAZ,CAAgB,QAAhB,EAA0BQ,MAA1B;IACD;;IAEDH,SAAS,CAACK,OAAV,CAAkB,CAACC,QAAD,EAAWC,GAAX,KAAmB;MACnC,KAAKxB,MAAL,CAAYY,GAAZ,CAAiB,GAAEW,QAAS,KAAIH,MAAM,CAACI,GAAD,CAAM,EAA5C;MACA,KAAKxB,MAAL,CAAYY,GAAZ,CAAiB,KAAIW,QAAS,EAA9B,EAAiCH,MAAM,CAACI,GAAD,CAAvC;IACD,CAHD;EAID;;EAEMC,WAAW,GAAG;IACnB,KAAKvB,MAAL,GAAc,EAAd;EACD;;AAnEsD"}