{"version":3,"file":"Logger.js","names":["Logger","driver","colors","level","LOG_ALL","logLevel","stringToLevel","printFragmented","debugFn","originDriver","ConsoleBufferDriver","print","setDriver","undefined","returnResult","msgText","prefix","offset","log","buildMessage","shouldLog","INFO","msg","info","DEBUG","debug","error","ERROR","Error","stack","isString","lines","split","groupCollapsed","listLogFn","forEach","line","performLines","groupEnd","TRACE","trace","panelText","Object","create","bgColor","color","baseText","Message","instance","pushBlock","MessageBlock","background","offsetLeft","borderRadius","padding","blockConfigs","length","blocks","blockConfig","isObject","isEmptyObject","push","block","offsetRight"],"sources":["../../src/Logger.ts"],"sourcesContent":["import { LoggerDriver } from './drivers/LoggerDriver'\nimport ConsoleBufferDriver from './drivers/ConsoleBufferDriver'\nimport type { LevelType } from './LogLevel'\nimport { DEBUG, ERROR, INFO, LOG_ALL, StringLevelType, stringToLevel, TRACE } from './LogLevel'\nimport Message from './Message'\nimport type { MessageBlockConfig } from './MessageBlock'\nimport MessageBlock from './MessageBlock'\nimport { ColorValue } from './Color'\nimport ColorCollection from './ColorCollection'\nimport { isEmptyObject, isObject, isString } from './utils'\n\nexport interface LoggerConfig {\n  driver: LoggerDriver\n  colors: ColorCollection\n  level?: StringLevelType\n}\n\nexport interface PanelOptions {\n  bgColor?: ColorValue | string\n  color?: ColorValue | string\n  offset?: number\n}\n\nexport type BlockPanel = string | MessageBlockConfig | MessageBlock\n\nclass Logger {\n  private driver: LoggerDriver\n  private originDriver?: LoggerDriver\n  private readonly colors: ColorCollection\n\n  private logLevel: LevelType = LOG_ALL\n\n  constructor({ driver, colors, level }: LoggerConfig) {\n    this.driver = driver\n    this.colors = colors\n\n    if (level) {\n      if (typeof level === 'string') {\n        this.logLevel = stringToLevel(level)\n      } else {\n        this.logLevel = level\n      }\n    }\n  }\n\n  setLogLevel(level: LevelType): void {\n    this.logLevel = level\n  }\n\n  addLogLevel(level: LevelType): void {\n    this.logLevel |= level\n  }\n\n  excludeLogLevel(level: LevelType): void {\n    this.logLevel ^= level\n  }\n\n  public getDriver(): LoggerDriver {\n    return this.driver\n  }\n\n  public setDriver(driver: LoggerDriver): this {\n    this.driver = driver\n\n    return this\n  }\n\n  public enableDebug({ printFragmented, debugFn }: { printFragmented?: boolean; debugFn?: Function } = {}): this {\n    this.originDriver = this.driver\n    this.driver = new ConsoleBufferDriver({ print: true, printFragmented, debugFn })\n\n    return this\n  }\n\n  public disableDebug(): this {\n    if (this.originDriver) {\n      this.setDriver(this.originDriver)\n      this.originDriver = undefined\n    }\n\n    return this\n  }\n\n  public returnResult(): this {\n    this.driver.returnResult()\n\n    return this\n  }\n\n  public getColors(): ColorCollection {\n    return this.colors\n  }\n\n  protected shouldLog(level: StringLevelType): boolean {\n    if (typeof level === 'string') {\n      level = stringToLevel(level)\n    }\n\n    return (this.logLevel & level) !== 0\n  }\n\n  log(msgText: Message | BlockPanel, prefix?: BlockPanel, offset = 0): string[] | void {\n    return this.driver.log(this.buildMessage(msgText, prefix, offset))\n  }\n\n  info(msgText: Message | BlockPanel, prefix?: BlockPanel, offset = 0): string[] | void {\n    if (!this.shouldLog(INFO)) {\n      return\n    }\n\n    const msg = this.buildMessage(msgText, prefix, offset)\n\n    return this.driver.info(msg)\n  }\n\n  debug(msgText: Message | BlockPanel, prefix?: BlockPanel, offset = 0): string[] | void {\n    if (!this.shouldLog(DEBUG)) {\n      return\n    }\n\n    return this.driver.debug(this.buildMessage(msgText, prefix, offset))\n  }\n\n  error(msgText: Message | BlockPanel, prefix?: BlockPanel, error?: Error, offset = 0): string[] | void {\n    if (!this.shouldLog(ERROR)) {\n      return\n    }\n\n    if (error instanceof Error && error.stack && isString(error.stack)) {\n      const lines = error.stack.split('\\n')\n      this.groupCollapsed(this.buildMessage(msgText, prefix, offset), lines)\n      return\n    }\n\n    return this.driver.error(this.buildMessage(msgText, prefix, offset))\n  }\n\n  groupCollapsed(msgText: Message | BlockPanel, lines: string[] = [], listLogFn: string = 'log'): void {\n    this.driver.groupCollapsed(this.buildMessage(msgText))\n\n    lines.forEach(line => {\n      this.driver.performLines([line], listLogFn)\n    })\n\n    this.driver.groupEnd()\n  }\n\n  trace(msgText: Message | BlockPanel, prefix?: BlockPanel, offset = 0): string[] | void {\n    if (!this.shouldLog(TRACE)) {\n      return\n    }\n\n    return this.driver.trace(this.buildMessage(msgText, prefix, offset))\n  }\n\n  /**\n   * @deprecated\n   * @use panels\n   */\n  panel(\n    panelText: string | MessageBlock,\n    { bgColor, color, offset }: PanelOptions = Object.create(null),\n    baseText?: string | MessageBlock,\n    logLevel?: StringLevelType\n  ): string[] | void {\n    if (logLevel && !this.shouldLog(logLevel)) {\n      return\n    }\n\n    const msg = Message.instance(undefined, this.colors).pushBlock(\n      MessageBlock.instance(panelText, { colors: this.colors })\n        .background(bgColor || 'white')\n        .color(color || 'gray')\n        .offsetLeft(offset || 0)\n        .borderRadius(3)\n        .padding(2, 4),\n\n      baseText ? MessageBlock.instance(baseText, { colors: this.colors }).offsetLeft(1) : null\n    )\n\n    return this.driver.log(msg)\n  }\n\n  panels(logLevel?: StringLevelType, ...blockConfigs: BlockPanel[]): string[] | void {\n    if (!blockConfigs.length || (logLevel && !this.shouldLog(logLevel))) {\n      return\n    }\n\n    const blocks: MessageBlock[] = []\n    blockConfigs.forEach(blockConfig => {\n      if ((isString(blockConfig) && blockConfig !== '') || (isObject(blockConfig) && !isEmptyObject(blockConfig))) {\n        blocks.push(MessageBlock.instance(blockConfig, { colors: this.colors }))\n      }\n    })\n\n    if (!blocks.length) {\n      return\n    }\n\n    const msg = Message.instance().pushBlock(...blocks)\n\n    return this.driver.log(msg)\n  }\n\n  private buildMessage(msgText: Message | BlockPanel, prefix?: BlockPanel, offset: number = 0): Message {\n    if (msgText instanceof Message) {\n      return msgText\n    }\n\n    const msg = new Message(undefined, this.colors)\n\n    if (prefix) {\n      const block = MessageBlock.instance(prefix, { colors: this.colors }).offsetRight(1)\n\n      if (offset) {\n        block.offsetLeft(offset)\n      }\n\n      msg.pushBlock(block)\n    }\n\n    msg.pushBlock(MessageBlock.instance(msgText, { colors: this.colors }))\n\n    return msg\n  }\n}\n\nexport default Logger\n"],"mappings":"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"}